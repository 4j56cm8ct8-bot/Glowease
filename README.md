# Glowease
// Tailored storefront JS for GlowEase product
const PRODUCTS_URL = '/products.json';

async function fetchProducts(){ const res = await fetch(PRODUCTS_URL); return res.json(); }
function formatPrice(n){ return Number(n).toFixed(2); }
function getCart(){ return JSON.parse(localStorage.getItem('glowease_cart') || '[]'); }
function saveCart(cart){ localStorage.setItem('glowease_cart', JSON.stringify(cart)); updateCartCount(); renderCartItems(); }
function addToCart(id){ const cart = getCart(); const existing = cart.find(i=>i.id===id); if(existing) existing.qty+=1; else cart.push({id,qty:1}); saveCart(cart); }
function removeFromCart(id){ saveCart(getCart().filter(i=>i.id!==id)); }
function updateQty(id, qty){ const cart = getCart(); const item = cart.find(i=>i.id===id); if(!item) return; item.qty = qty; if(item.qty<=0) removeFromCart(id); else saveCart(cart); }
function updateCartCount(){ const count = getCart().reduce((s,i)=>s+i.qty,0); const el = document.getElementById('cart-count'); if(el) el.textContent = count; }
async function renderProducts(){ const el = document.getElementById('products'); if(!el) return; const products = await fetchProducts(); el.innerHTML = products.map(p=>`<article class="card"><img src="${p.image}" alt="${p.title}"><h4>${p.title}</h4><p>${p.description}</p><div class="price">â¬${formatPrice(p.price)}</div><div style="display:flex;gap:.5rem;margin-top:.5rem"><button class="btn btn-primary" onclick="addToCart('${p.id}')">Ajouter</button><a class="btn btn-ghost" href="/product.html?id=${p.id}">Voir</a></div></article>`).join(''); }
async function renderProductDetail(){ const el = document.getElementById('product-detail'); if(!el) return; const params = new URLSearchParams(location.search); const id = params.get('id'); const products = await fetchProducts(); const p = products.find(x=>x.id===id); if(!p){ el.innerHTML = '<p>Produit introuvable.</p>'; return; } el.innerHTML = `<div><img src="${p.image}" alt="${p.title}"></div><div><h2>${p.title}</h2><p>${p.long || p.description}</p><p class="price">â¬${formatPrice(p.price)}</p><p><strong>CoÃ»t estimÃ© fournisseur:</strong> â¬${formatPrice(p.cost_est)}</p><p><strong>DÃ©lais de livraison estimÃ©s:</strong> ${p.ship_est}</p><div style="margin-top:1rem"><button class="btn btn-primary" onclick="addToCart('${p.id}')">Ajouter au panier</button></div><section style="margin-top:1rem"><h4>FAQ</h4><p><strong>Retour:</strong> VÃ©rifie la politique sur la commande. <strong>Instructions:</strong> Utilise doucement 2-3 fois/semaine sur peau sensible.</p></section></div>`; }
function openCart(){ document.getElementById('cart-modal').classList.remove('hidden'); renderCartItems(); }
function closeCart(){ document.getElementById('cart-modal').classList.add('hidden'); }
async function renderCartItems(){ const list = document.getElementById('cart-items'); if(!list) return; const cart = getCart(); const products = await fetchProducts(); if(cart.length===0){ list.innerHTML = '<li>Panier vide.</li>'; document.getElementById('cart-total').textContent='0.00'; return; } let total = 0; list.innerHTML = cart.map(ci=>{ const p = products.find(x=>x.id===ci.id); const line = p.price * ci.qty; total += line; return `<li style="display:flex;justify-content:space-between;gap:1rem;padding:.5rem 0;border-bottom:1px solid #eee"><div><strong>${p.title}</strong><br><small>â¬${formatPrice(p.price)} x <input style="width:48px" value="${ci.qty}" onchange="updateQtyFromInput('${ci.id}', this.value)"></small></div><div style="text-align:right">â¬${formatPrice(line)}<br><button class="btn btn-ghost" onclick="removeFromCart('${ci.id}')">Supprimer</button></div></li>`; }).join(''); document.getElementById('cart-total').textContent = formatPrice(total); updateCartCount(); }
function updateQtyFromInput(id, val){ const v = parseInt(val || '0', 10); updateQty(id, isNaN(v)?1:v); }
function checkoutPlaceholder(){ alert('Exemple: ici tu dois brancher Stripe/PayPal ou utiliser Shopify pour gÃ©rer paiements et commandes.'); }
document.addEventListener('DOMContentLoaded', ()=>{ updateCartCount(); const cartBtn = document.getElementById('cart-button'); if(cartBtn) cartBtn.addEventListener('click', openCart); const closeBtn = document.getElementById('close-cart'); if(closeBtn) closeBtn.addEventListener('click', closeCart); const checkoutBtn = document.getElementById('checkout'); if(checkoutBtn) checkoutBtn.addEventListener('click', checkoutPlaceholder); renderProducts(); renderProductDetail(); });
